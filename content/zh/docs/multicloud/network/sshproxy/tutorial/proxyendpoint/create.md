---
title: "新建代理节点"
date: 2021-12-16T15:50:56+08:00
weight: 10
description: >
    新建SSH代理节点
---

### 虚拟机配置要求


- 目前只支持Linux操作系统的虚拟机作为SSH代理节点。
- 请确保虚拟机处于运行中状态；
- 请确保虚拟机支持通过平台免密登录；虚拟机能被平台免密登录，则要求虚拟机与平台网络通（即通过EIP、NAT网关或SSH代理等方式使虚拟机与平台网络通）以及虚拟机中存在平台的公钥文件。
- 请检查虚拟机的sshd配置，GatewayPorts是clientspecified，若该项值为no，则只允许绑定127.0.0.1的地址，使remote forward无法正常使用，造成安装监控Agent的虚拟机无法向平台上报监控数据等。

### 操作步骤

该功能用于新建代理节点。

1. 在SSH代理节点页面，单击列表上方 **_"新建"_** 按钮，进入新建SSH代理节点页面。
2. 在选择虚拟机页面设置以下参数：
    - 域：设置SSH代理节点所属域，并通过域过滤可选的虚拟机。
    - 名称：设置SSH代理节点的名称。
    - 区域：通过平台、区域过滤VPC。
    - 网络：通过VPC、网络过滤虚拟机。
    - 虚拟机：通过上面的筛选条件过滤出符合条件的虚拟机，并支持在搜索框中通过名称和IP搜索虚拟机，请确保所选的虚拟机符合[虚拟机配置要求](#虚拟机配置要求)，如没有合适的虚拟机，可以单击“新建”超链接，跳转到虚拟机列表页面创建符合需求的虚拟机。
3. 选择好虚拟机后，单击 **_"下一步"_** 按钮，开始探测虚拟机的免密登录状态。
    - 如虚拟机可免密登录，可直接单击 **_"确定"_** 按钮，开始创建虚拟机。
    - 如虚拟机不可免密登录，请先点击列表操作列 **_"查看"_** 按钮，查看探测免密登录失败的具体原因。
        - 如报错原因中提示“none publickey”或因为ssh端口不是默认端口而导致无法免密登录时，可通过设置免密登录功能，将虚拟机设置为免密登录状态。设置免密登录方式配置参数如下：
            - SSH端口：修改虚拟机的SSH端口，将通过该端口免密登录到虚拟机。
            - 设置方式：支持密钥、密码、脚本等方式将平台的公钥上传到虚拟机上。
            - 当设置方式为“密钥”时，请使用root用户或具有使用sudo免密权限的用户以其私钥，请确保可以通过用户名和私钥通过ssh连接到对应虚拟机，单击 **_"确定"_** 按钮，开始设置并探测虚拟机的免密登录状态是否变为免密登录。
            - 当设置方式为“密码”时，请使用root用户或具有使用sudo免密权限的用户以其密码，请确保可以通过用户名和密码通过ssh连接到对应虚拟机。单击 **_"确定"_** 按钮，开始设置并探测虚拟机的免密登录状态是否变为免密登录。
            - 当设置方式为“脚本”时，请请使用root或具有sudo权限的用户在虚拟机中执行以下脚本，执行完成后，单击 **_"确定"_** 按钮，开始设置并探测虚拟机的免密登录状态是否变为免密登录。
        - 如报错原因中提示“network error”，则需要返回上一步选择其他虚拟机，或为该虚拟机通过绑定EIP或NAT网关等方式，使其与平台网络可通。
4. 只有当虚拟机免密登录状态为“可免密登录”时，才支持单击 **_"确定"_** 按钮，开始创建SSH代理节点。
5. 在创建SSH代理节点时将会检查虚拟机的sshd配置是否符合虚拟机配置要求，若不符合将会尝试变更虚拟机的sshd配置，因此可能会造成创建ssh代理节点时间过长，若提示超时，请重新单击 **_"确定"_** 按钮，创建SSH代理节点。