---
title: "新建TCP监听"
date: 2021-12-17T17:05:49+08:00
weight: 10
description: >
    新建TCP协议的监听
---

TCP监听适用于注重可靠性，对数据准确性要求高，速度可以相对较慢的场景，如文件传输、收发邮件、远程登录等；用户可创建TCP监听来转发开自客户端的TCP请求。

{{% alert title="注意" color="warning" %}}
当用户希望通过TCP协议监听22端口时，则需要在对应的转发节点（虚拟机、宿主机或外部机器）上修改sshd配置文件。将"/etc/ssh/sshd_config"配置文件的`#ListenAddress 0.0.0.0`改为`ListenAddress <转发节点IP>` 
{{% /alert %}}

{{< tabs name="create_tcp" >}}
{{% tab name="OpenStack" %}}

### OpenStack

1. 在负载均衡实例页面，单击OpenStack平台的实例名称项，进入实例详情页面。
2. 单击“监听”页签，进入监听页面。
3. 单击列表上方 **_"新建"_** 按钮，弹出新建负载均衡监听对话框，配置协议&监听相关参数。 
    - 名称：设置监听的名称。
    - 监听端口：用来接收请求并向后端服务器转发请求的端口，端口范围为1-65535。
    - 协议：支持监听TCP、UDP、HTTP、HTTPS协议，协议选择为“TCP”。

    **高级设置**：默认隐藏，可根据需求进行配置。

    - 调度算法：设置负载均衡的调度算法。
        - 轮询(RR)：按照访问顺序依次将外部请求分发到后端服务器组。
        - 加权轮询(WRR)：权重值越高的后端服务器，被轮询到的次数（概率）也越高。
        - 加权最小连接数(WLC)：除了根据每台后端服务器设定的权重值来进行轮询，同时还考虑后端服务器的实际负载（即连接数）。当权重值相同时，当前连接数越小的后端服务器被轮询到的次数（概率）也越高。
        - 源IP一致性哈希(SCH)：基于源IP地址的一致性hash，相同的源地址会调度到相同的后端服务器。
    - 启用访问控制：设置是否启用访问控制，如勾选启用访问控制后，需要设置访问控制方式以及访问策略控制组。
        - 访问控制方式：白名单即允许访问控制策略组中的IP访问负载均衡；黑名单即禁止访问控制策略组中的IP访问负载均衡。只支持白名单。
        - 访问控制策略组：选择访问控制策略组，请先在访问控制页面创建策略组。
    - 后端连接超时时间：转发节点收到客户端请求后，请求后端服务器的超时时间。
    - 后端连接空闲时间：设置转发节点与后端服务器的连接空闲时间。
    - 连接空闲超时时间：连接会话建议后允许的空闲时间，在超时时间内一直没有访问请求，将会暂时中断当前连接。     
4. 单击 **_"下一步：后端服务器组"_** 按钮，选择后端服务器组，如无后端服务器组，可新建。
5. 单击 **_"下一步：健康检查"_** 按钮，配置健康检查相关参数。
    - 开启健康检查：选择是否开启健康检查，若勾选开启健康检查，配置以下参数。
    - 健康检查协议：选择健康检查协议，包括TCP和HTTP，TCP协议健康检查通过发送SYN握手报文来检测服务器端口是否存活；HTTP协议健康检查通过发送HEAD/GET请求模拟浏览器的访问行为来检查服务器应用是否健康。
    - 健康检查路径（仅支持HTTP）：设置健康检查的URL地址的路径。
    - 健康检查域名（仅支持HTTP）：设置健康检查的请求域名。
    - 正常状态码（仅支持HTTP）：设置健康检查正常的HTTP状态码。
    - 健康检查响应超时时间：健康检查响应的最大超时时间，如在响应时间内未响应，则判定健康检查异常。
    - 健康检查健康阈值：连续n（n为设置的值）次收到健康检查的结果为成功，则显示状态为健康。
    - 健康检查不健康阈值：连续n（n为设置的值）次收到健康检查的结果为识别，则显示状态为异常。
6. 单击 **_"确定"_** 按钮，完成操作。

{{% /tab %}}

{{% tab name="阿里云" %}}

### 阿里云

1. 在负载均衡实例页面，单击阿里云平台的实例名称项，进入实例详情页面。
2. 单击“监听”页签，进入监听页面。
3. 单击列表上方 **_"新建"_** 按钮，弹出新建负载均衡监听对话框，配置协议&监听相关参数。 
    - 名称：设置监听的名称。
    - 监听端口：用来接收请求并向后端服务器转发请求的端口，端口范围为1-65535。
    - 协议：支持监听TCP、UDP、HTTP、HTTPS协议，协议选择为“TCP”。

    **高级设置**：默认隐藏，可根据需求进行配置。

    - 调度算法：设置负载均衡的调度算法。
        - 轮询(RR)：按照访问顺序依次将外部请求分发到后端服务器组。
        - 加权轮询(WRR)：权重值越高的后端服务器，被轮询到的次数（概率）也越高。
        - 加权最小连接数(WLC)：除了根据每台后端服务器设定的权重值来进行轮询，同时还考虑后端服务器的实际负载（即连接数）。当权重值相同时，当前连接数越小的后端服务器被轮询到的次数（概率）也越高。
    - 启用访问控制：设置是否启用访问控制，如勾选启用访问控制后，需要设置访问控制方式以及访问策略控制组。
        - 访问控制方式：白名单即允许访问控制策略组中的IP访问负载均衡；黑名单即禁止访问控制策略组中的IP访问负载均衡。
        - 访问控制策略组：选择访问控制策略组，请先在访问控制页面创建策略组。
4. 单击 **_"下一步：后端服务器组"_** 按钮，选择后端服务器组，如无后端服务器组，可新建。
5. 单击 **_"下一步：健康检查"_** 按钮，配置健康检查相关参数。
    - 开启健康检查：选择是否开启健康检查，若勾选开启健康检查，配置以下参数。
    - 健康检查协议：选择健康检查协议，包括TCP和HTTP，TCP协议健康检查通过发送SYN握手报文来检测服务器端口是否存活；HTTP协议健康检查通过发送HEAD/GET请求模拟浏览器的访问行为来检查服务器应用是否健康。
    - 健康检查间隔时间：负载均衡进行健康检查的时间间隔
    - 健康检查健康阈值：连续n（n为设置的值）次收到健康检查的结果为成功，则显示状态为健康。
    - 健康检查不健康阈值：连续n（n为设置的值）次收到健康检查的结果为识别，则显示状态为异常。
6. 单击 **_"确定"_** 按钮，完成操作。

{{% /tab %}}

{{% tab name="腾讯云" %}}

### 腾讯云

1. 在负载均衡实例页面，单击腾讯云平台的实例名称项，进入实例详情页面。
2. 单击“监听”页签，进入监听页面。
3. 单击列表上方 **_"新建"_** 按钮，弹出新建负载均衡监听对话框，配置协议&监听相关参数。 
    - 名称：设置监听的名称。
    - 监听端口：用来接收请求并向后端服务器转发请求的端口，端口范围为1-65535。
    - 协议：支持监听TCP、UDP、HTTP、HTTPS协议，协议选择为“TCP”。

    **高级设置**：默认隐藏，可根据需求进行配置。

    - 调度算法：设置负载均衡的调度算法。
        - 加权轮询(WRR)：权重值越高的后端服务器，被轮询到的次数（概率）也越高。
        - 加权最小连接数(WLC)：除了根据每台后端服务器设定的权重值来进行轮询，同时还考虑后端服务器的实际负载（即连接数）。当权重值相同时，当前连接数越小的后端服务器被轮询到的次数（概率）也越高。
    - 开启会话保持：选择是否开启会话保持，开启会话保持后，负载均衡监听会把来自同一客户端的请求分发到同一台服务器上。调度算法为加权最小连接数时不支持会话保持。
        - 会话超时时间：当超过设置时间后，连接内无新的请求，将会自动断开会话保持。
4. 单击 **_"下一步：后端服务器组"_** 按钮，选择后端服务器组，如无后端服务器组，可新建。   
5. 单击 **_"下一步：健康检查"_** 按钮，配置健康检查相关参数。
    - 开启健康检查：选择是否开启健康检查，若勾选开启健康检查，配置以下参数：
    - 健康检查间隔时间：负载均衡进行健康检查的时间间隔。
    - 健康检查健康阈值：连续n（n为设置的值）次收到健康检查的结果为成功，则显示状态为健康。
    - 健康检查不健康阈值：连续n（n为设置的值）次收到健康检查的结果为识别，则显示状态为异常。
6. 单击 **_"确定"_** 按钮，完成操作。

{{% /tab %}}

{{% tab name="华为云" %}}

### 华为云

1. 在负载均衡实例页面，单击华为云平台的实例名称项，进入实例详情页面。
2. 单击“监听”页签，进入监听页面。
3. 单击列表上方 **_"新建"_** 按钮，弹出新建负载均衡监听对话框，配置协议&监听相关参数。 
    - 名称：设置监听的名称。
    - 监听端口：用来接收请求并向后端服务器转发请求的端口，端口范围为1-65535。
    - 协议：支持监听TCP、UDP、HTTP、HTTPS协议，协议选择为“TCP”。

    **高级设置**：默认隐藏，可根据需求进行配置。

    - 调度算法：设置负载均衡的调度算法。
        - 加权轮询(WRR)：权重值越高的后端服务器，被轮询到的次数（概率）也越高。
        - 加权最小连接(WLC)：除了根据每台后端服务器设定的权重值来进行轮询，同时还考虑后端服务器的实际负载（即连接数）。当权重值相同时，当前连接数越小的后端服务器被轮询到的次数（概率）也越高。
        - 源IP一致性哈希(SCH)：基于源IP地址的一致性hash，相同的源地址会调度到相同的后端服务器。
    - 开启会话保持：选择是否开启会话保持，开启会话保持后，负载均衡监听会把来自同一客户端的请求分发到同一台服务器上。
        - 会话超时时间：当超过设置时间后，连接内无新的请求，将会自动断开会话保持。
    - 启用访问控制：设置是否启用访问控制，如勾选启用访问控制后，需要设置访问控制方式以及访问策略控制组。
        - 访问控制方式：白名单即允许访问控制策略组中的IP访问负载均衡；黑名单即禁止访问控制策略组中的IP访问负载均衡。
        - 访问控制策略组：选择访问控制策略组，请先在访问控制页面创建策略组。
4. 单击 **_"下一步：后端服务器组"_** 按钮，选择后端服务器组，如无后端服务器组，可新建。   
5. 单击 **_"下一步：健康检查"_** 按钮，配置健康检查相关参数。
    - 开启健康检查：选择是否开启健康检查，若勾选开启健康检查，配置以下参数。
    - 健康检查协议：选择健康检查协议，包括TCP和HTTP，TCP协议健康检查通过发送SYN握手报文来检测服务器端口是否存活；HTTP协议健康检查通过发送HEAD/GET请求模拟浏览器的访问行为来检查服务器应用是否健康。
    - 健康检查间隔时间：负载均衡进行健康检查的时间间隔。
    - 健康检查健康阈值：连续n（n为设置的值）次收到健康检查的结果为成功，则显示状态为健康。
    - 健康检查不健康阈值：连续n（n为设置的值）次收到健康检查的结果为识别，则显示状态为异常。
6. 单击 **_"确定"_** 按钮，完成操作。

{{% /tab %}}

{{% tab name="AWS" %}}

### 网络型AWS

1. 在负载均衡实例页面，单击AWS平台的网络型实例名称项，进入实例详情页面。
2. 单击“监听”页签，进入监听页面。
3. 单击列表上方 **_"新建"_** 按钮，弹出新建负载均衡监听对话框，配置协议&监听相关参数。 
    - 名称：设置监听的名称。
    - 监听端口：用来接收请求并向后端服务器转发请求的端口，端口范围为1-65535。
    - 协议：支持监听TCP、UDP、HTTP、HTTPS协议，协议选择为“TCP”。
4. 单击 **_"下一步：后端服务器组"_** 按钮，选择后端服务器组，如无后端服务器组，可新建。   
5. 单击 **_"下一步：健康检查"_** 按钮，配置健康检查相关参数。
    - 开启健康检查：AWS的监听不支持关闭健康检查，配置以下参数。
    - 健康检查协议：选择健康检查协议，包括TCP、HTTP、HTTPS，TCP协议健康检查通过发送SYN握手报文来检测服务器端口是否存活；HTTP协议健康检查通过发送HEAD/GET请求模拟浏览器的访问行为来检查服务器应用是否健康；HTTPS协议健康检查即负载均衡实例向指定的服务器端口发HTTPS请求进行健康检查。。
    - 健康检查间隔时间：负载均衡进行健康检查的时间间隔。
    - 健康检查健康阈值：连续n（n为设置的值）次收到健康检查的结果为成功，则显示状态为健康。
6. 单击 **_"确定"_** 按钮，完成操作。

{{% /tab %}}

{{< /tabs >}}